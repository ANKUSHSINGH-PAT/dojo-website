/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["CodeGlass.HTML-Beautify"]){dojo._hasResource["CodeGlass.HTML-Beautify"]=true;dojo.provide("CodeGlass.HTML-Beautify");dojo.require("CodeGlass.beautify");dojo.mixin(CodeGlass,{style_html:function(_1,_2,_3,_4){var _5,_6;function _5(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(_7,_8){for(var i=0;i<_8.length;i++){if(_7===_8[i]){return true;}}return false;}};this.get_content=function(){var _9="";var _a=[];var _b=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return _a.length?_a.join(""):["","TK_EOF"];}_9=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(_9,this.Utils.whitespace)){if(_a.length){_b=true;}this.line_char_count--;continue;}else{if(_b){if(this.line_char_count>=this.max_char){_a.push("\n");for(var i=0;i<this.indent_level;i++){_a.push(this.indent_string);}this.line_char_count=0;}else{_a.push(" ");this.line_char_count++;}_b=false;}}_a.push(_9);}return _a.length?_a.join(""):"";};this.get_script=function(){var _c="";var _d=[];var _e=new RegExp("</script"+">","igm");_e.lastIndex=this.pos;var _f=_e.exec(this.input);var _10=_f?_f.index:this.input.length;while(this.pos<_10){if(this.pos>=this.input.length){return _d.length?_d.join(""):["","TK_EOF"];}_c=this.input.charAt(this.pos);this.pos++;_d.push(_c);}return _d.length?_d.join(""):"";};this.record_tag=function(tag){if(this.tags[tag+"count"]){this.tags[tag+"count"]++;this.tags[tag+this.tags[tag+"count"]]=this.indent_level;}else{this.tags[tag+"count"]=1;this.tags[tag+this.tags[tag+"count"]]=this.indent_level;}this.tags[tag+this.tags[tag+"count"]+"parent"]=this.tags.parent;this.tags.parent=tag+this.tags[tag+"count"];};this.retrieve_tag=function(tag){if(this.tags[tag+"count"]){var _11=this.tags.parent;while(_11){if(tag+this.tags[tag+"count"]===_11){break;}_11=this.tags[_11+"parent"];}if(_11){this.indent_level=this.tags[tag+this.tags[tag+"count"]];this.tags.parent=this.tags[_11+"parent"];}delete this.tags[tag+this.tags[tag+"count"]+"parent"];delete this.tags[tag+this.tags[tag+"count"]];if(this.tags[tag+"count"]==1){delete this.tags[tag+"count"];}else{this.tags[tag+"count"]--;}}};this.get_tag=function(){var _12="";var _13=[];var _14=false;do{if(this.pos>=this.input.length){return _13.length?_13.join(""):["","TK_EOF"];}_12=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(_12,this.Utils.whitespace)){_14=true;this.line_char_count--;continue;}if(_12==="'"||_12==="\""){if(!_13[1]||_13[1]!=="!"){_12+=this.get_unformatted(_12);_14=true;}}if(_12==="="){_14=false;}if(_13.length&&_13[_13.length-1]!=="="&&_12!==">"&&_14){if(this.line_char_count>=this.max_char){this.print_newline(false,_13);this.line_char_count=0;}else{_13.push(" ");this.line_char_count++;}_14=false;}_13.push(_12);}while(_12!==">");var _15=_13.join("");var _16;if(_15.indexOf(" ")!=-1){_16=_15.indexOf(" ");}else{_16=_15.indexOf(">");}var _17=_15.substring(1,_16).toLowerCase();if(_15.charAt(_15.length-2)==="/"||this.Utils.in_array(_17,this.Utils.single_token)){this.tag_type="SINGLE";}else{if(_17==="script"){this.record_tag(_17);this.tag_type="SCRIPT";}else{if(_17==="style"){this.record_tag(_17);this.tag_type="STYLE";}else{if(_17.charAt(0)==="!"){if(_17.indexOf("[if")!=-1){if(_15.indexOf("!IE")!=-1){var _18=this.get_unformatted("-->",_15);_13.push(_18);}this.tag_type="START";}else{if(_17.indexOf("[endif")!=-1){this.tag_type="END";this.unindent();}else{if(_17.indexOf("[cdata[")!=-1){var _18=this.get_unformatted("]]>",_15);_13.push(_18);this.tag_type="SINGLE";}else{var _18=this.get_unformatted("-->",_15);_13.push(_18);this.tag_type="SINGLE";}}}}else{if(_17.charAt(0)==="/"){this.retrieve_tag(_17.substring(1));this.tag_type="END";}else{this.record_tag(_17);this.tag_type="START";}if(this.Utils.in_array(_17,this.Utils.extra_liners)){this.print_newline(true,this.output);}}}}}return _13.join("");};this.get_unformatted=function(_19,_1a){if(_1a&&_1a.indexOf(_19)!=-1){return "";}var _1b="";var _1c="";var _1d=true;do{_1b=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(_1b,this.Utils.whitespace)){if(!_1d){this.line_char_count--;continue;}if(_1b==="\n"||_1b==="\r"){_1c+="\n";for(var i=0;i<this.indent_level;i++){_1c+=this.indent_string;}_1d=false;this.line_char_count=0;continue;}}_1c+=_1b;this.line_char_count++;_1d=true;}while(_1c.indexOf(_19)==-1);return _1c;};this.get_token=function(){var _1e;if(this.last_token==="TK_TAG_SCRIPT"){var _1f=this.get_script();if(typeof _1f!=="string"){return _1f;}_1e=CodeGlass.js_beautify(_1f,{indent_size:this.indent_size,indent_char:this.indent_character,indent_level:this.indent_level});return [_1e,"TK_CONTENT"];}if(this.current_mode==="CONTENT"){_1e=this.get_content();if(typeof _1e!=="string"){return _1e;}else{return [_1e,"TK_CONTENT"];}}if(this.current_mode==="TAG"){_1e=this.get_tag();if(typeof _1e!=="string"){return _1e;}else{var _20="TK_TAG_"+this.tag_type;return [_1e,_20];}}};this.printer=function(_21,_22,_23,_24){this.input=_21||"";this.output=[];this.indent_character=_22||" ";this.indent_string="";this.indent_size=_23||2;this.indent_level=0;this.max_char=_24||70;this.line_char_count=0;for(var i=0;i<this.indent_size;i++){this.indent_string+=this.indent_character;}this.print_newline=function(_25,arr){this.line_char_count=0;if(!arr||!arr.length){return;}if(!_25){while(this.Utils.in_array(arr[arr.length-1],this.Utils.whitespace)){arr.pop();}}arr.push("\n");for(var i=0;i<this.indent_level;i++){arr.push(this.indent_string);}};this.print_token=function(_26){this.output.push(_26);};this.indent=function(){this.indent_level++;};this.unindent=function(){if(this.indent_level>0){this.indent_level--;}};};return this;};_6=new _5();_6.printer(_1,_3,_2);while(true){var t=_6.get_token();_6.token_text=t[0];_6.token_type=t[1];if(_6.token_type==="TK_EOF"){break;}switch(_6.token_type){case "TK_TAG_START":case "TK_TAG_SCRIPT":case "TK_TAG_STYLE":_6.print_newline(false,_6.output);_6.print_token(_6.token_text);_6.indent();_6.current_mode="CONTENT";break;case "TK_TAG_END":_6.print_newline(true,_6.output);_6.print_token(_6.token_text);_6.current_mode="CONTENT";break;case "TK_TAG_SINGLE":_6.print_newline(false,_6.output);_6.print_token(_6.token_text);_6.current_mode="CONTENT";break;case "TK_CONTENT":if(_6.token_text!==""){_6.print_newline(false,_6.output);_6.print_token(_6.token_text);}_6.current_mode="TAG";break;}_6.last_token=_6.token_type;_6.last_text=_6.token_text;}return _6.output.join("");}});}