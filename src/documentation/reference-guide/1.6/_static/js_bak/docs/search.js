/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo.require("dojo.io.script");(function(){CRUMB="4ew4jEiWU6V";APPID="ln3gX3rV34EvEQ.NGNUTRQ74qzERccjg2bBpFDrNZhgDkKFLumweq_ZuaX.Yv7iE9Q--";VERSION=0.2;var _1="Enter keywords here and click search";var _2;var _3;var _4;var _5;var _6;var _7;var _8;var _9=[];var _a="";var _b;var _c;var _d="The amount of results returned from each search";var _e="Search the entire web, only Dojo resources, or specific Dojo resources";var _f={ten:{checked:true,title:_d},twenty:{checked:false,title:_d},fifty:{checked:false,title:_d},web:{checked:false,title:_e},dojoAll:{checked:true,title:_e},dojoSpecific:{checked:false,title:_e},rJS:{checked:true,title:"Excludes JavaScript files from search results. This filter is inexact - a small amount of relevant results may mistakenly be filtered."},rDesc:{checked:true,title:"Show or hide result descriptions"},rLink:{checked:true,title:"Show or hide result links"},rIndex:{checked:true,title:"Show or hide numbered result"},"dojotoolkit.org":{url:"dojotoolkit.org",name:"dojotoolkit.org",title:"Search the vast resources of The Dojo Toolikit's primary website",primary:true,checked:true},"dojocampus.org":{url:"dojocampus.org",title:"Dojo training, online lessons, tutorials",name:"dojocampus.org",primary:true,checked:true},"sitepen.com":{url:"www.sitepen.com",title:"Expert Dojo Tips from the people who invented Dojo",name:"sitepen.com",primary:true,checked:true},"dojoforum.com":{url:"www.dojoforum.com/forum",title:"Secondary Dojo Forums",name:"dojoforum.com",primary:true,checked:true},"ibm.com":{url:"www.ibm.com/developerworks/",name:"ibm.com",title:"IBM's resource for developers",primary:true,checked:true},"nabble.com":{url:"nabble.com",name:"nabble.com",title:"Dojo-Interest Mailing List",primary:true,checked:true},"alex.dojotoolkit.org":{url:"alex.dojotoolkit.org",name:"alex.dojotoolkit.org",title:"Continuing Intermittent Incoherency",primary:true,checked:true},"shaneosullivan.com":{url:"shaneosullivan.wordpress.com",name:"shaneosullivan.com",title:"Shane O'Sullivan's technical blog",primary:true,checked:true},"dojotoolkit.org/forum/":{url:"www.dojotoolkit.org/forum/",title:"The Primary Dojo Forum",name:"dojotoolkit.org/forum/",primary:false,checked:true},"api.dojotoolkit.org":{url:"api.dojotoolkit.org",name:"api.dojotoolkit.org",title:"The Dojo API documentation",primary:false,checked:true},"archive.dojotoolkit.org":{url:"archive.dojotoolkit.org",name:"archive.dojotoolkit.org",title:"Dojo builds and svn checkouts",primary:false,checked:false},"trac.dojotoolkit.org":{url:"trac.dojotoolkit.org",name:"trac.dojotoolkit.org",title:"The Dojo bug tracking application",primary:false,checked:false},"bugs.dojotoolkit.org":{url:"bugs.dojotoolkit.org",name:"bugs.dojotoolkit.org",title:"The Dojo bug tracking application",primary:false,checked:false},"svn.dojotoolkit.org":{url:"svn.dojotoolkit.org",name:"svn.dojotoolkit.org",title:"Dojo source files",primary:false,checked:false},included:function(){var _10=[];for(var nm in this){if(this[nm].primary){_10.push(this[nm]);}}this.included=function(){return _10;};return _10;},excluded:function(){var _11=[];for(var nm in this){if(this[nm].primary===false){_11.push(this[nm]);}}this.excluded=function(){return _11;};return _11;},all:function(){return this.included().concat(this.excluded());},plus:function(){var _12=[];if(_b.web){return "";}else{if(_b.dojoSpecific){dojo.forEach(this.all(),function(_13){if(_b[_13.name]){_12.push(_13.url);}});}else{dojo.forEach(this.included(),function(_14){_12.push(_14.url);},this);}}return _12.join(",");},minus:function(){var _15=[];dojo.forEach(this.excluded(),function(_16){if(!_b[_16.name]||_b.scope=="dojo"){_15.push(_16.url);}},this);return dojo.map(_15,function(s){return " -site:"+s;}).join("");}};var _17={minus:function(){return " -pipermail";},plus:function(){return " +dojo";}};var _18={plus:function(){return "";},minus:function(){if(!_b.rJS){return "";}return " -inurl:js";}};var _19={template:"<li id=\"${id}\" class=\"${checked}\" value=\"${url}\" title=\"${title}\">${name}</li>",_reg:new RegExp(/\$\{.*?\}/gi),getHtml:function(_1a){return this.template.replace(this._reg,function(m){return _1a[m.substring(2,m.length-1)];});},buildGroup:function(_1b){var str="";dojo.forEach(_1b,function(_1c){var _1d=dojo.mixin({},_1c);_1d.id=_1d.name;_1d.checked=_1d.checked?"checked":"";str+=this.getHtml(_1d);},this);return str;},build:function(){dojo.byId("specific").innerHTML=this.buildGroup(_f.included());dojo.byId("specific").innerHTML+=this.buildGroup(_f.excluded());}};var _1e={makeItem:function(_1f,_20){var _21=_1f.title+(_1f.content||"");var _22=_1f.url;var _23=_1f["abstract"];var str="<div class=\"yahooResult\">"+"<div class=\"row-t\"></div><div class=\"row-m\">"+"<span class=\"itemIndex\">"+_20+"</span><a class=\"itemTitle\" href=\""+_22+"\" target=\"_blank\">"+(_21||"&nbsp;")+"</a>"+"<div class=\"itemDesc\">"+_23+"</div>"+"<a class=\"itemLink\" href=\""+_22+"\" target=\"_blank\">"+_22+"</a>"+"</div><div class=\"row-b\">"+"</div>";_6.innerHTML+=str;},onData:function(_24,_25,arg){_6.innerHTML="";dojo.removeClass(_5,"beginSearch");dojo.removeClass(_5,"searching");_26.changed();numStart=Number(_24.ysearchresponse.start)+1;var r=_24.ysearchresponse.resultset_web;if(!r||!r.length){dojo.addClass(_5,"noResults");_6.innerHTML="<div id=\"NoResults\">The search returned no results.</div>";dojo.byId("resultDisplay").innerHTML="No Results";}else{dojo.byId("resultDisplay").innerHTML="Showing Results "+numStart+" to "+(numStart+r.length-1)+" of "+_24.ysearchresponse.totalhits+" total results.";dojo.removeClass(_5,"noResults");for(var i=0;i<r.length;i++){this.makeItem(r[i],numStart+i);}}}};var _26={searchStart:0,isSearching:false,isEmpty:function(){return !dojo.trim(_7.value)||dojo.trim(_7.value)==_1;},onFocus:function(){if(dojo.trim(_7.value)==_1){_7.value="";}dojo.removeClass(_7,"empty");},onBlur:function(){var _27=this.isEmpty();if(_27){dojo.addClass(_7,"empty");_7.value=_1;}},changed:function(){var _28=(_7.value!=_a&&_7.value!="");dojo.style(_3,"display","");dojo.style(_2,"display",this.searchStart==0?"none":"");return _28;},next:function(){console.warn("NEXT");var amt=dojo.attr(dojo.byId("resultAmountSelect"),"value");console.log("result amount::",amt,"start::",this.searchStart);this.searchStart=Number(this.searchStart)+Number(amt);},prev:function(){var amt=dojo.attr(dojo.byId("resultAmountSelect"),"value");this.searchStart=Math.max(0,this.searchStart-amt);},setInput:function(s){console.log("set hash");s=unescape(s.substring(1,s.length)),p=new RegExp(/\+/g),s=s.replace(p," ");_7.value=s;},hash:function(str){if(str){if(location.search){location.search="";}location.hash=str;this._lastHash=str;this.blockHashCheck();return true;}else{if(location.search&&location.search!=this._lastHash){return location.search.substring(1,location.search.length);}else{if(location.hash&&location.hash!=this._lastHash){return location.hash.substring(1,location.hash.length);}}}return false;},hashInterval:1000,blockHashCheck:function(){this.hashCheckBlocked=true;setTimeout(dojo.hitch(this,function(){this.hashCheckBlocked=false;}),this.blockHashCheck*1.4);},onChangeHash:function(){if(!this._hcinit){this._hcinit=true;setInterval(dojo.hitch(this,"onChangeHash"),this.hashInterval);return;}var h=this.hash();if(h&&h!=this._lastHash&&!this.hashCheckBlocked){this._lastHash=h;this.setInput(h);this.search();}},search:function(evt){_3.blur();_2.blur();_29.off();if(this.isSearching||this.isEmpty()){return;}this.isSearching=true;if(this.changed()){this.searchStart=0;}_6.innerHTML="<div id=\"searching\">Searching...</div>";dojo.addClass(_5,"searching");var _2a=_7.value.replace(new RegExp(/\s/g),"+");_a=_7.value;_2a=escape(_2a);this.hash(_2a);var _2b;if(_b.scope!="web"){_2b=_2a+_17.plus()+_17.minus()+_18.plus()+_18.minus()+_f.minus();}else{_2b=_2a;}var url="http://boss.yahooapis.com/ysearch/web/v1/"+_2b;var def=dojo.io.script.get({url:url,callbackParamName:"callback",content:{sites:_f.plus(),count:dojo.attr(dojo.byId("resultAmountSelect"),"value"),start:this.searchStart,appid:APPID,format:"json",crumb:CRUMB}});def.addCallback(this,function(res){console.log("results",_1e);this.isSearching=false;_1e.onData(res);});def.addErrback(this,function(res){this.isSearching=false;console.error("SEARCH ERROR:",res);});return;}};var ui={cookie:function(_2c,_2d){if(arguments.length==1){if(_c){var _2e=document.cookie.match(new RegExp("(?:^|; )"+_2c+"=([^;]*)"));var val=_2e?decodeURIComponent(_2e[1]):undefined;if(val=="false"){val=false;}if(val=="true"){val=true;}return val;}else{document.cookie=_2c+"="+encodeURIComponent(_2d)+"; expires=0";return undefined;}}else{var d=new Date();d.setMonth(d.getMonth()+2);document.cookie=_2c+"="+encodeURIComponent(_2d)+"; expires="+d.toUTCString();return true;}},_clearGroup:function(el){if(this.className(el.parentNode,"radio")){if(!this.className(el,"checked")){dojo.forEach(el.parentNode.childNodes,function(n){if(n.tagName&&n.tagName.toLowerCase()=="li"){this.className(n,"checked",false);}},this);return true;}else{return false;}}return true;},check:function(el,_2f){el=dojo.byId(el);var _30;var _31=_2f===undefined||_2f===null;var chk=_2f=="toggle"?!this.className(el,"checked"):_2f;if(el.tagName.toLowerCase()=="ul"){dojo.query("li",el).forEach(function(n){if(_31&&this.className(n,"checked")){_30=n.id;}else{if(n.id==_2f){this.check(n);}}},this);}else{if(_31){_30=this.className(el,"checked");}else{if(this.className(el,"checked")!=chk&&this._clearGroup(el)){this.className(el,"checked",chk);}}}return _30;},saveState:function(){dojo.forEach(_9,function(f){this.cookie(f,this.check(f));},this);},init:function(_32){var val,c;dojo.forEach(_9,function(f){if(_32){val=_f[f].checked;}else{c=this.cookie(f);val=c===undefined?_f[f].checked:c;}this.check(f,val);if(!_32){dojo.attr(dojo.byId(f),"title",_f[f].title);this.className(_5,"beginSearch",true);}},this);this.onChange();},className:function(_33,_34,add){if(arguments.length==3){if(add){dojo.addClass(_33,_34);}else{dojo.removeClass(_33,_34);}return add;}else{return dojo.hasClass(_33,_34);}},onChange:function(evt){if(evt){this.check(evt.target,"toggle");}_b=this.formToObject(_8);console.log("oForm:",_b);var _35={ten:10,twenty:20,fifty:50};dojo.attr(dojo.byId("resultAmountSelect"),"value",_35[ui.check("resultAmountSelect")]);this.className(_5,"descriptions",_b.rDesc);this.className(_5,"links",_b.rLink);this.className(_5,"indexes",_b.rIndex);this.className(_5,"specific",_b.dojoSpecific);this.saveState();},formToObject:function(_36){var o={};var _37=dojo.query("li",_36).forEach(function(el){o[el.id]=this.className(el,"checked");},this);return o;}};var _29={on:function(){dojo.addClass(_5,"about");},off:function(){dojo.removeClass(_5,"about");}};ydojo={init:function(){_c=true;var v=ui.cookie("searchVersion");var _38=!v?false:Number(v)>=VERSION?true:false;ui.cookie("searchVersion",VERSION,true);_c=_c;console.info("COOKIE VALID:",_c);_7=dojo.byId("query");_5=dojo.byId("wrapper");_6=dojo.byId("results");_8=dojo.byId("optionsForm");_4=dojo.byId("searchButton");_3=dojo.byId("nextButton");_2=dojo.byId("prevButton");dojo.style(_2,"display","none");dojo.byId("emailHere").innerHTML="<a href=\"mailto:mwilcox@sitepen.com\">Mike Wilcox at SitePen</a>";_19.build();dojo.query("li",_8).forEach(function(n){if(!dojo.some(_9,function(f){return f==n.id;})){_9.push(n.id);}});dojo.connect(dojo.byId("searchForm"),"submit",function(evt){_26.search();dojo.stopEvent(evt);});dojo.connect(_3,"click",_26,"next");dojo.connect(_2,"click",_26,"prev");dojo.connect(_7,"keyup",_26,"changed");dojo.connect(_7,"focus",_26,"onFocus");dojo.connect(_7,"blur",_26,"onBlur");dojo.connect(dojo.byId("optionsForm"),"click",ui,"onChange");dojo.connect(dojo.byId("aboutOn"),"click",_29,"on");dojo.connect(dojo.byId("aboutOff"),"click",_29,"off");dojo.connect(dojo.byId("resetButton"),"click",function(){ui.init(true);return false;});ui.init();_29.on();dojo.setSelectable(dojo.byId("sub_footer"),false);dojo.setSelectable(dojo.byId("sp_logo_holder"),false);if(_26.hash()){_26.search();}else{_7.focus();}},search:function(){_26.search();}};})();dojo.addOnLoad(function(){ydojo.init();});var brwr;if(dojo.isIE){brwr="dj_ie";}else{if(dojo.isFF){brwr="dj_ff";}else{if(dojo.isWebKit){brwr="dj_webkit";}else{if(dojo.isSafari){brwr="dj_safari";}}}}dojo.addOnLoad(function(){dojo.doc.documentElement.className+=brwr;});