//>>built
define("docs/RstEditor","dojo/_base/declare dojo/_base/Deferred dojo/_base/event dojo/_base/fx dojo/_base/kernel dojo/_base/lang dojo/_base/xhr dojo/dom dojo/dom-style dojo/on dijit/_WidgetBase dijit/_HasDropDown dijit/form/TextBox dijit/form/Button".split(" "),function(l,f,e,g,m,c,h,d,b,k,n,p,q,r){return l(null,[n,p],{toggleButtonId:"rstwiki-editActionButton",saveButtonId:"rstwiki-saveButton",previewPanelId:"rstwiki-previewPanel",contentPanelId:"rstwiki-contentPanel",editControlsId:"rstwiki-editControls",
resetButtonId:"rstwiki-resetButton",editorMessageId:"rstwiki-editorMessage",noticeId:"rstwiki-noticenode",height:400,_dropDownPosition:["below"],buildRendering:function(){this.editing=!1;this.previewPanel=d.byId(this.previewPanelId);this.contentPanel=d.byId(this.contentPanelId);this.editControls=d.byId(this.editControlsId);this.toggleButton=d.byId(this.toggleButtonId);this.saveButton=d.byId(this.saveButtonId);this.resetButton=d.byId(this.resetButtonId);this.editorMessage=d.byId(this.editorMessageId);
this.notice=d.byId(this.noticeId);this._buttonNode=this._aroundNode=this.saveButton;this.inherited(arguments)},postCreate:function(){this.toggleButton&&(this.connect(this.toggleButton,"onclick","toggle"),this.connect(this.saveButton,"onclick","save"),this.connect(this.resetButton,"onclick","reset"));this.connect(m.global,"onkeydown","onKeyDown");this.connect(this.domNode,"onkeyup","onChange");this.connect(this.domNode,"onchange","onChange");this.connect(this.domNode,"onpaste","_onCopyPaste");this.connect(this.domNode,
"oncut","_onCopyPaste");this.dropDown=new dijit.TooltipDialog({content:'\x3cdiv\x3ePlease describe your changes\x3c/div\x3e\x3ctextarea cols\x3d40 rows\x3d3 id\x3d"'+this.id+'_textarea" name\x3d"message"\x3e\x3c/textarea\x3e\x3cbr\x3e\x3cbutton id\x3d"'+this.id+'_commit" data-dojo-type\x3d"dijit.form.Button" type\x3d"submit"\x3eSave\x3c/button\x3e\x3cbutton id\x3d"'+this.id+'_cancel" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3eCancel\x3c/button\x3e'})},onKeyDown:function(a){switch(a.which){case 69:if(!a.metaKey)break;
this.toggle(a);break;case 83:if(!a.metaKey)break;this.save(a)}},onChange:function(){this.editing&&(this._delayedFetch&&clearTimeout(this._delayedFetch),this.editorMessage.innerHTML=this.domNode.value!=this._previousContent?"Content has changed.":"",this._delayedFetch=setTimeout(c.hitch(this,function(){this.getPreview()}),500))},_onCopyPaste:function(){setTimeout(c.hitch(this,"onChange"),10)},save:function(a){a&&e.stop(a);if(this._previousContent&&this.domNode.value!=this._previousContent){this.saving=
!0;this.editorMessage.innerHTML="Saving.";this.openDropDown();var b=this,c=k(d.byId(this.id+"_commit"),"click",function(a){e.stop(a);b.commit(d.byId(this.id+"_textarea").value);b.closeDropDown();c.remove()}),c=k(d.byId(this.id+"_cancel"),"click",this,function(a){e.stop(a);this.closeDropDown();c.remove()})}},commit:function(a){this._previousContent&&this.domNode.value!=this._previousContent&&(this.saving=!0,this.editorMessage.innerHTML="Saving.",h.post({url:window.location,content:{content:this.domNode.value,
message:a,action:"bare"},handleAs:"text",load:c.hitch(this,function(a){this.saving=!1;delete this._previousContent;a&&this.contentPanel.innerHTML!=a&&(this.contentPanel.innerHTML=a);this.editorMessage.innerHTML=""}),error:c.hitch(this,function(){this.editorMessage.innerHTML="";this.saving=!1})}),this.hide())},show:function(){this._showDef=new f;b.set(this.domNode,{display:"",height:""});g.animateProperty({node:this.domNode,duration:150,properties:{height:this.height},onEnd:c.hitch(this._showDef,"resolve",
!0)}).play();if(!this._previousContent||this._previousContent==this.domNode.value)this._previousContent=this.domNode.value;b.set(this.contentPanel,"display","none");b.set(this.previewPanel,"display","");b.set(this.editControls,"display","");b.set(this.notice,"display","");this.toggleButton.innerHTML="hide editor";return this._showDef.then(c.hitch(this,"onShow"))},hide:function(){this._delayedFetch&&clearTimeout(this._delayedFetch);this._hideDef=new f;g.animateProperty({node:this.domNode,duration:150,
properties:{height:0},onEnd:c.hitch(this._hideDef,"resolve",!0)}).play();b.set(this.contentPanel,"display","block");b.set(this.previewPanel,"display","none");b.set(this.editControls,"display","none");b.set(this.notice,"display","none");return this._hideDef.then(c.hitch(this,function(){b.set(this.domNode,"display","none");this.toggleButton.innerHTML="edit"})).then(c.hitch(this,"onHide"))},toggle:function(a){a&&e.stop(a);"none"==b.get(this.domNode,"display")?this.show():this.hide()},reset:function(a){confirm("Are you sure? Your changes will be lost.")&&
(e.stop(a),this.domNode.value=this._previousContent)},getPreview:function(a){if(a||this.editing&&!this.saving)if(this.previewPanel.innerHTML=this.contentPanel.innerHTML,!this.previewPanel.innerHTML||!this._previewContent||this.domNode.value!=this._previewContent)this._previewContent=this.domNode.value,h.post({url:window.location,content:{preview:this._previewContent,id_prefix:"preview_"},handleAs:"text",load:c.hitch(this,function(a){b.set(this.contentPanel,"display","none");!this.saving&&(a!=this.previewPanel.innerHTML&&
this.domNode.value==this._previewContent)&&(this.previewPanel.innerHTML=a)})})},onShow:function(){this.editing=!0;this.previewPanel.innerHTML||this.getPreview();this.editorMessage.innerHTML=this._previousContent&&this.domNode.value!=this._previousContent?"Content has changed.":"";this.domNode.focus()},onHide:function(){this.editing=!1;this._previousContent&&this.domNode.value!=this._previousContent?this.saving||(this.editorMessage.innerHTML="Content has changed."):this.editorMessage.innerHTML=""}})});
//# sourceMappingURL=RstEditor.js.map